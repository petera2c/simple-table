import{jsxs as e,jsx as n,Fragment as r}from"react/jsx-runtime";import t,{useState as o,useRef as a,useCallback as c,useEffect as i,Children as l,useLayoutEffect as s,forwardRef as u,createRef as d,createContext as f,useContext as g,Fragment as v,useMemo as h,useReducer as m}from"react";var p=function(){return p=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},p.apply(this,arguments)};function w(e,n,r){if(r||2===arguments.length)for(var t,o=0,a=n.length;o<a;o++)!t&&o in n||(t||(t=Array.prototype.slice.call(n,0,o)),t[o]=n[o]);return e.concat(t||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var b=function(e){var n={};return l.forEach(e,(function(e,r){if(e.ref&&e.ref.current){var t=e.ref.current.getBoundingClientRect();n[e.key]=t}})),n},C=function(e){var n,r,c=e.allowHorizontalAnimate,l=void 0===c||c,u=e.children,d=e.pauseAnimation,f=e.tableRef,g=a(!1),v=o({}),h=v[0],m=v[1],p=o({}),w=p[0],C=p[1],D=(n=u,r=a(),i((function(){r.current=n}),[n]),r.current);return s((function(){var e=b(u);m(e)}),[u]),s((function(){var e=b(D);C(e);var n=f.current,r=function(){g.current=!0;var e=b(D);m(e),C(e)},t=function(){g.current=!1};return null==n||n.addEventListener("scroll",r),null==n||n.addEventListener("scrollend",t),function(){null==n||n.removeEventListener("scroll",r),null==n||n.removeEventListener("scrollend",t)}}),[D,f]),i((function(){d||g.current||Object.keys(w).length&&t.Children.forEach(u,(function(e,n){var r=e.ref.current,t=w[e.key],o=h[e.key];if(t&&o){var a=t.left-o.left,c=l?0:t.top-o.top,i=Math.abs(a),s=Math.abs(c);(i>10||s>10)&&requestAnimationFrame((function(){r.style.transform="translate(".concat(a,"px, ").concat(c,"px)"),r.style.transition="transform 0s",requestAnimationFrame((function(){r.style.transform="",r.style.transition="transform 500ms"}))}))}}))}),[l,h,u,d,w]),u},D=!1,y=function(e){var n=e.draggedHeaderRef,r=e.headersRef,t=e.hoveredHeaderRef,o=e.onTableHeaderDragEnd;return{handleDragStart:function(e){n.current=e},handleDragOver:function(e){!function(e){var a;if(!D&&(t.current=e,e.accessor!==(null===(a=n.current)||void 0===a?void 0:a.accessor)&&null!==n.current&&!D)){if(D=!0,!r.current)return;var c=w([],r.current,!0),i=c.findIndex((function(e){var r;return e.accessor===(null===(r=n.current)||void 0===r?void 0:r.accessor)})),l=c.findIndex((function(n){return n.accessor===e.accessor}));if(void 0===i||void 0===l)return;var s=c.splice(i,1)[0];c.splice(l,0,s),JSON.stringify(c)!==JSON.stringify(r.current)&&setTimeout((function(){o(c),setTimeout((function(){D=!1}),500)}),50)}}(e)},handleDragEnd:function(){n.current=null,t.current=null}}},R=function(e,n){var r=!0,t=!0;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(r)return r=!1,void setTimeout((function(){return t=!1}),n);t||(e.apply(this,o),t=!0,setTimeout((function(){return t=!1}),n))}},x=u((function(r,t){var c,l=r.draggable,s=r.draggedHeaderRef,u=r.columnResizing,d=r.forceUpdate,f=r.headersRef,g=r.hoveredHeaderRef,v=r.index,h=r.onSort,m=r.onTableHeaderDragEnd,w=r.setIsWidthDragging,b=r.sort,C=r.sortDownIcon,D=r.sortUpIcon,x=a({pageX:0,pageY:0}),I=o(!1),E=I[0],M=I[1],L=null===(c=f.current)||void 0===c?void 0:c[v],A=Boolean(null==L?void 0:L.isSortable),N="st-header-cell ".concat(L===g.current?"st-hovered":""," ").concat(E?"st-dragging":""," ").concat(A?"clickable":""," ").concat(l&&!A?"draggable":""),T=y({draggedHeaderRef:s,headersRef:f,hoveredHeaderRef:g,onTableHeaderDragEnd:m}),k=T.handleDragStart,S=T.handleDragOver,B=T.handleDragEnd,H=a(R((function(e){S(e)}),100)).current,O=function(e){e.isSortable&&h(v,e.accessor)};return i((function(){var e=function(e){var n=new Image;n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",e.dataTransfer.setDragImage(n,0,0)};return document.addEventListener("dragend",e,!1),function(){document.removeEventListener("dragend",e)}}),[]),L?e("div",p({className:N,ref:t,style:{width:L.width}},{children:[n("div",p({className:"st-header-label",draggable:l,onClick:function(){return O(L)},onDragStart:function(e){l&&L&&(e.dataTransfer.dropEffect="move",function(e){M(!0),k(e)}(L))},onDragOver:function(e){return function(e,n){e.preventDefault(),e.dataTransfer.dropEffect="move";var r=e.pageX,t=e.pageY;r===x.current.pageX&&t===x.current.pageY||(x.current={pageX:r,pageY:t},H(n,e))}(e,L)},onDragEnd:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",M(!1),B()},onMouseEnter:function(){return document.body.style.overflow="hidden"},onMouseLeave:function(){return document.body.style.overflow="auto"}},{children:null==L?void 0:L.label})),b&&b.key.accessor===L.accessor&&e("div",p({className:"st-sort-icon-container",onClick:function(){return O(L)}},{children:["ascending"===b.direction&&D&&D,"descending"===b.direction&&C&&C]})),u&&n("div",{className:"st-header-resize-handle",onMouseDown:function(e){w(!0),e.preventDefault();var n=e.clientX;if(L){var r=L.width,t=R((function(e){var t=Math.max(r+(e.clientX-n),10);L&&(f.current[v].width=t,d())}),10),o=function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",o),w(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",o)}}})]})):null})),I=u((function(e,r){return e.visible?n("div",{className:"st-cell",ref:r}):n("div",{ref:r})})),E=function(){return n("div",{className:"st-row-separator"})},M=function(t){var o,c=t.draggable,i=t.columnResizing,l=t.forceUpdate,s=t.headersRef,u=t.isWidthDragging,f=t.onSort,g=t.onTableHeaderDragEnd,v=t.setIsWidthDragging,h=t.shouldDisplayLastColumnCell,m=t.sort,w=t.sortDownIcon,b=t.sortUpIcon,D=t.tableRef,y=a(null),R=a(null);return e(r,{children:[e(C,p({pauseAnimation:u,tableRef:D},{children:[null===(o=s.current)||void 0===o?void 0:o.map((function(e,r){return n(x,{draggable:c,draggedHeaderRef:y,columnResizing:i,forceUpdate:l,headersRef:s,hoveredHeaderRef:R,index:r,onSort:f,onTableHeaderDragEnd:g,ref:d(),setIsWidthDragging:v,sort:m,sortDownIcon:w,sortUpIcon:b},e.accessor)})),n(I,{ref:d(),visible:h})]})),n(E,{})]})},L=function(r){var t=r.value,o=r.onBlur,a=r.onChange;return e("select",p({value:t.toString(),onBlur:o,onChange:a},{children:[n("option",p({value:"true"},{children:"True"})),n("option",p({value:"false"},{children:"False"}))]}))},A=function(e){var r=e.defaultValue,t=e.onBlur,o=e.onChange,c=a(null);return n("input",{className:"editable-cell-input",ref:c,autoFocus:!0,type:"text",defaultValue:r,onBlur:t,onChange:o})},N=function(e){var t=e.onChange,o=e.setIsEditing,a=e.value,c=function(e){var n=e.target.value;null==t||t(n)},i=function(){o(!1)};return n(r,{children:"string"==typeof a?n(A,{defaultValue:a,onBlur:i,onChange:c}):"boolean"==typeof a?n(L,{value:a,onBlur:i,onChange:c}):null})},T=f({rows:[],tableRows:[]}),k=u((function(e,r){var t=e.borderClass,a=e.colIndex,c=e.content,l=e.header,s=e.isSelected,u=e.isTopLeftCell,d=e.onCellChange,f=e.onMouseDown,v=e.onMouseOver,h=e.row,m=e.rowIndex,w=g(T),b=w.rows,C=w.tableRows,D=o(c),y=D[0],R=D[1],x=o(!1),I=x[0],E=x[1],M=Boolean(null==l?void 0:l.isEditable),L=m%2==0,A="st-cell ".concat(s?u?"st-cell-selected-first-cell ".concat(t):"st-cell-selected ".concat(t):""," ").concat(L?"st-cell-odd-row":""," ").concat(M?"clickable":"");i((function(){R(c)}),[c]),i((function(){if(void 0!==h.originalRowIndex&&"number"==typeof h.originalRowIndex){var e=b[h.originalRowIndex];e[l.accessor]!==y?R(e[l.accessor]):C[h.originalRowIndex][l.accessor]=y}}),[l.accessor,y,b,h.originalRowIndex,C]);return n("div",I?p({className:"st-cell-editing ".concat(L?"st-cell-odd-row":"")},{children:n(N,{onChange:function(e){R(e),null==d||d({accessor:l.accessor,newValue:e,newRowIndex:m,originalRowIndex:h.originalRowIndex,row:h})},setIsEditing:E,value:y})}):p({className:A,onDoubleClick:function(){return l.isEditable&&E(!0)},onMouseDown:function(){return f(m,a)},onMouseOver:function(){return v(m,a)},ref:r},{children:y}))})),S=function(t){var o=t.getBorderClass,a=t.handleMouseDown,c=t.handleMouseOver,i=t.headers,l=t.isSelected,s=t.isTopLeftCell,u=t.isWidthDragging,f=t.onCellChange,g=t.shouldDisplayLastColumnCell,h=t.shouldPaginate,m=t.sortedRows,w=t.tableRef;return n(r,{children:m.map((function(r,t){return e(v,{children:[e(C,p({allowHorizontalAnimate:h,pauseAnimation:u,tableRef:w},{children:[i.map((function(e,i){var u=r[e.accessor];return e.cellRenderer&&(u=e.cellRenderer(r)),n(k,{borderClass:o(t,i),colIndex:i,content:u,header:e,isSelected:l(t,i),isTopLeftCell:s(t,i),onCellChange:f,onMouseDown:function(){return a(t,i)},onMouseOver:function(){return c(t,i)},ref:d(),row:r,rowIndex:t},e.accessor)})),n(I,{ref:d(),visible:g})]})),t!==m.length-1&&n(E,{})]},r.originalRowIndex)}))})},B=function(r){var t=r.currentPage,o=r.hideFooter,a=r.nextIcon,c=r.onPageChange,i=r.prevIcon,l=r.rowsPerPage,s=r.shouldPaginate,u=r.totalRows,d=Math.ceil(u/l),f=function(e){e>=1&&e<=d&&c(e)};return o||!s?null:e("div",p({className:"st-footer"},{children:[n("button",p({className:"st-next-prev-btn",onClick:function(){return f(t-1)},disabled:1===t},{children:i})),n("button",p({className:"st-next-prev-btn",onClick:function(){return f(t+1)},disabled:t===d},{children:a})),Array.from({length:d},(function(e,r){return n("button",p({onClick:function(){return f(r+1)},className:"st-page-btn ".concat(t===r+1?"active":"")},{children:r+1}),r)}))]}))},H=function(){return n("svg",p({className:"angle-icon",viewBox:"0 0 24 24",width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}))},O=function(){return n("svg",p({className:"angle-icon",viewBox:"0 0 24 24",width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})}))},P=function(e){var r=e.className;return n("svg",p({className:r,viewBox:"0 0 20 20",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M5.41 11.41L10 6.83l4.59 4.58L16 10l-6-6-6 6z"})}))},U=function(e){var r=e.className;return n("svg",p({className:r,viewBox:"0 0 20 20",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M5.41 7.59L10 12.17l4.59-4.58L16 9l-6 6-6-6z"})}))},z=function(e){return e.editColumns,e.headersRef,e.onTableHeaderDragEnd,null},j=function(r){var t=r.columnResizing,l=void 0!==t&&t,s=r.defaultHeaders,u=r.draggable,d=void 0!==u&&u,f=r.editColumns,g=void 0!==f&&f,v=r.height,b=r.hideFooter,C=void 0!==b&&b,D=r.nextIcon,y=void 0===D?n(O,{}):D,R=r.onCellChange,x=r.prevIcon,I=void 0===x?n(H,{}):x,E=r.rows,L=r.rowsPerPage,A=void 0===L?10:L,N=r.selectableCells,k=void 0!==N&&N,j=r.shouldPaginate,W=void 0!==j&&j,F=r.sortDownIcon,X=void 0===F?n(U,{className:"st-sort-icon"}):F,V=r.sortUpIcon,Y=void 0===V?n(P,{className:"st-sort-icon"}):V,Q=h((function(){return E.map((function(e,n){return p(p({},e),{originalRowIndex:n})}))}),[E]),q=a(null),J=o(!1),K=J[0],G=J[1],Z=a(s),$=o(null),_=$[0],ee=$[1],ne=o(1),re=ne[0],te=ne[1],oe=h((function(){if(!_)return Q;var e=function(e,n,r){var t=r?r.key:e[0],o="ascending";return r&&r.key.accessor===t.accessor&&"ascending"===r.direction&&(o="descending"),{sortedData:w([],n,!0).sort((function(e,n){return e[t.accessor]<n[t.accessor]?"ascending"===o?1:-1:e[t.accessor]>n[t.accessor]?"ascending"===o?-1:1:0})),newSortConfig:{key:t,direction:o}}}(Z.current,Q,_).sortedData;return e}),[Q,_]),ae=m((function(e){return e+1}),0)[1],ce=function(e){var n=e.selectableCells,r=e.headers,t=e.rows,l=o([]),s=l[0],u=l[1],d=a(!1),f=a(null),g=c((function(){var e=s.reduce((function(e,n){var o=n.row,a=n.col;return e[o]||(e[o]=[]),e[o][a]=t[o][r[a].accessor],e}),{}),n=Object.values(e).map((function(e){return Object.values(e).join("\t")})).join("\n");navigator.clipboard.writeText(n)}),[s,t,r]);i((function(){var e=function(e){(e.ctrlKey||e.metaKey)&&"c"===e.key&&g()};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[g,s]);var v=function(e,n){return s.some((function(r){return r.row===e&&r.col===n}))};return{selectedCells:s,handleMouseDown:function(e,r){n&&(d.current=!0,f.current={row:e,col:r},u([{row:e,col:r}]))},handleMouseOver:function(e,r){if(n&&d.current&&f.current){for(var t=[],o=Math.min(f.current.row,e),a=Math.max(f.current.row,e),c=Math.min(f.current.col,r),i=Math.max(f.current.col,r),l=o;l<=a;l++)for(var s=c;s<=i;s++)t.push({row:l,col:s});u(t)}},handleMouseUp:function(){d.current=!1,f.current=null},isSelected:v,getBorderClass:function(e,n){var r=[];return v(e-1,n)||r.push("st-selected-top-border"),v(e+1,n)||r.push("st-selected-bottom-border"),v(e,n-1)||r.push("st-selected-left-border"),v(e,n+1)||r.push("st-selected-right-border"),r.join(" ")},isTopLeftCell:function(e,n){return e===Math.min.apply(Math,s.map((function(e){return e.row})))&&n===Math.min.apply(Math,s.map((function(e){return e.col})))},setSelectedCells:u}}({selectableCells:k,headers:Z.current,rows:oe}),ie=ce.handleMouseDown,le=ce.handleMouseOver,se=ce.handleMouseUp,ue=ce.isSelected,de=ce.getBorderClass,fe=ce.isTopLeftCell,ge=ce.setSelectedCells,ve=Z.current.filter((function(e){return!e.hide})),he=h((function(){return!!q.current&&ve.reduce((function(e,n){return e+n.width}),0)<q.current.clientWidth}),[ve]),me=W?oe.slice((re-1)*A,re*A):oe,pe=function(e){Z.current=e,ae()};return i((function(){var e=function(e){e.target.closest(".st-cell")||ge([])};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[ge]),n(T.Provider,p({value:{rows:E,tableRows:Q}},{children:e("div",p({ref:q,className:"st-wrapper",style:v?{height:v}:{}},{children:[e("div",p({className:"st-table",onMouseUp:se,onMouseLeave:se,style:{gridTemplateColumns:"".concat(null==ve?void 0:ve.map((function(e){return"".concat(e.width,"px")})).join(" ")," 1fr")}},{children:[n(M,{draggable:d,columnResizing:l,forceUpdate:ae,headersRef:Z,isWidthDragging:K,onSort:function(e,n){ee((function(r){return(null==r?void 0:r.key.accessor)!==n?{key:Z.current[e],direction:"ascending"}:"ascending"===(null==r?void 0:r.direction)?{key:Z.current[e],direction:"descending"}:null}))},onTableHeaderDragEnd:pe,setIsWidthDragging:G,shouldDisplayLastColumnCell:he,sort:_,sortDownIcon:X,sortUpIcon:Y,tableRef:q}),n(S,{getBorderClass:de,handleMouseDown:ie,handleMouseOver:le,headers:Z.current,isSelected:ue,isTopLeftCell:fe,isWidthDragging:K,onCellChange:R,shouldDisplayLastColumnCell:he,shouldPaginate:W,sortedRows:me,tableRef:q})]})),n(z,{editColumns:g,headersRef:Z,onTableHeaderDragEnd:pe}),n(B,{currentPage:re,hideFooter:C,nextIcon:y,onPageChange:te,prevIcon:I,rowsPerPage:A,shouldPaginate:W,totalRows:oe.length})]}))}))};export{j as SimpleTable};

import{jsxs as e,jsx as n,Fragment as r}from"react/jsx-runtime";import t,{useState as o,useRef as a,useCallback as c,useEffect as i,Children as s,useLayoutEffect as l,forwardRef as u,createRef as d,createContext as f,useContext as h,Fragment as v,useMemo as g,useReducer as m}from"react";var p=function(){return p=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},p.apply(this,arguments)};function w(e,n,r){if(r||2===arguments.length)for(var t,o=0,a=n.length;o<a;o++)!t&&o in n||(t||(t=Array.prototype.slice.call(n,0,o)),t[o]=n[o]);return e.concat(t||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var b=function(e){var n={};return s.forEach(e,(function(e){if(e&&e.ref&&e.ref.current){var r=e.ref.current.getBoundingClientRect();n[e.key]=r}})),n},C=function(e){var n,r,c=e.allowHorizontalAnimate,s=void 0===c||c,u=e.children,d=e.pauseAnimation,f=e.tableRef,h=a(!1),v=o({}),g=v[0],m=v[1],p=o({}),w=p[0],C=p[1],y=(n=u,r=a(),i((function(){r.current=n}),[n]),r.current);return l((function(){var e=b(u);m(e)}),[u]),l((function(){var e=b(y);C(e);var n=f.current,r=function(){h.current=!0;var e=b(y);m(e),C(e)},t=function(){h.current=!1};return null==n||n.addEventListener("scroll",r),null==n||n.addEventListener("scrollend",t),function(){null==n||n.removeEventListener("scroll",r),null==n||n.removeEventListener("scrollend",t)}}),[y,f]),i((function(){d||h.current||Object.keys(w).length&&t.Children.forEach(u,(function(e){if(e){var n=e.ref.current,r=w[e.key],t=g[e.key];if(r&&t){var o=r.left-t.left,a=s?0:r.top-t.top,c=Math.abs(o),i=Math.abs(a);(c>10||i>10)&&requestAnimationFrame((function(){n.style.transform="translate(".concat(o,"px, ").concat(a,"px)"),n.style.transition="transform 0s, opacity 0s",requestAnimationFrame((function(){n.style.transform="",n.style.transition="transform 300ms ease-out, opacity 300ms ease-out"}))}))}}}))}),[s,g,u,d,w]),u},y=!1,x=function(e){var n=e.draggedHeaderRef,r=e.headersRef,t=e.hoveredHeaderRef,o=e.onTableHeaderDragEnd;return{handleDragStart:function(e){n.current=e},handleDragOver:function(e){!function(e){var a;if(!y&&(t.current=e,e.accessor!==(null===(a=n.current)||void 0===a?void 0:a.accessor)&&null!==n.current&&!y)){if(y=!0,!r.current)return;var c=w([],r.current,!0),i=c.findIndex((function(e){var r;return e.accessor===(null===(r=n.current)||void 0===r?void 0:r.accessor)})),s=c.findIndex((function(n){return n.accessor===e.accessor}));if(void 0===i||void 0===s)return;var l=c.splice(i,1)[0];c.splice(s,0,l),JSON.stringify(c)!==JSON.stringify(r.current)&&setTimeout((function(){o(c),setTimeout((function(){y=!1}),500)}),50)}}(e)},handleDragEnd:function(){n.current=null,t.current=null}}},D=function(e,n){var r=!0,t=!0;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(r)return r=!1,void setTimeout((function(){return t=!1}),n);t||(e.apply(this,o),t=!0,setTimeout((function(){return t=!1}),n))}},R=u((function(r,t){var c,s=r.draggable,l=r.draggedHeaderRef,u=r.columnResizing,d=r.forceUpdate,f=r.headersRef,h=r.hoveredHeaderRef,v=r.index,g=r.onSort,m=r.onTableHeaderDragEnd,w=r.setIsWidthDragging,b=r.sort,C=r.sortDownIcon,y=r.sortUpIcon,R=a({pageX:0,pageY:0}),E=o(!1),I=E[0],N=E[1],M=null===(c=f.current)||void 0===c?void 0:c[v],k=Boolean(null==M?void 0:M.isSortable),L="st-header-cell ".concat(M===h.current?"st-hovered":""," ").concat(I?"st-dragging":""," ").concat(k?"clickable":""," ").concat(s&&!k?"draggable":""),A=x({draggedHeaderRef:l,headersRef:f,hoveredHeaderRef:h,onTableHeaderDragEnd:m}),T=A.handleDragStart,S=A.handleDragOver,O=A.handleDragEnd,B=a(D((function(e){S(e)}),100)).current,H=function(e){e.isSortable&&g(v,e.accessor)};return i((function(){var e=function(e){var n=new Image;n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",e.dataTransfer.setDragImage(n,0,0)};return document.addEventListener("dragend",e,!1),function(){document.removeEventListener("dragend",e)}}),[]),M?e("div",p({className:L,ref:t,style:{width:M.width}},{children:[n("div",p({className:"st-header-label",draggable:s,onClick:function(){return H(M)},onDragStart:function(e){s&&M&&(e.dataTransfer.dropEffect="move",function(e){N(!0),T(e)}(M))},onDragOver:function(e){return function(e,n){e.preventDefault(),e.dataTransfer.dropEffect="move";var r=e.pageX,t=e.pageY;r===R.current.pageX&&t===R.current.pageY||(R.current={pageX:r,pageY:t},B(n,e))}(e,M)},onDragEnd:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",N(!1),O()},onMouseEnter:function(){return document.body.style.overflow="hidden"},onMouseLeave:function(){return document.body.style.overflow="auto"}},{children:null==M?void 0:M.label})),b&&b.key.accessor===M.accessor&&e("div",p({className:"st-sort-icon-container",onClick:function(){return H(M)}},{children:["ascending"===b.direction&&y&&y,"descending"===b.direction&&C&&C]})),u&&n("div",{className:"st-header-resize-handle",onMouseDown:function(e){w(!0),e.preventDefault();var n=e.clientX;if(M){var r=M.width,t=D((function(e){var t=Math.max(r+(e.clientX-n),40);M&&(f.current[v].width=t,d())}),10),o=function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",o),w(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",o)}}})]})):null})),E=u((function(e,r){return e.visible?n("div",{className:"st-cell",ref:r}):n("div",{ref:r})})),I=function(t){var o,c=t.draggable,i=t.columnResizing,s=t.forceUpdate,l=t.headersRef,u=t.hiddenColumns,f=t.isWidthDragging,h=t.onSort,v=t.onTableHeaderDragEnd,g=t.setIsWidthDragging,m=t.shouldDisplayLastColumnCell,w=t.sort,b=t.sortDownIcon,y=t.sortUpIcon,x=t.tableRef,D=a(null),I=a(null);return n(r,{children:e(C,p({pauseAnimation:f,tableRef:x},{children:[null===(o=l.current)||void 0===o?void 0:o.map((function(e,r){return u[e.accessor]?null:n(R,{draggable:c,draggedHeaderRef:D,columnResizing:i,forceUpdate:s,headersRef:l,hoveredHeaderRef:I,index:r,onSort:h,onTableHeaderDragEnd:v,ref:d(),setIsWidthDragging:g,sort:w,sortDownIcon:b,sortUpIcon:y},e.accessor)})),n(E,{ref:d(),visible:m})]}))})},N=function(r){var t=r.value,o=r.onBlur,a=r.onChange;return e("select",p({value:t.toString(),onBlur:o,onChange:a},{children:[n("option",p({value:"true"},{children:"True"})),n("option",p({value:"false"},{children:"False"}))]}))},M=function(e){var r=e.defaultValue,t=e.onBlur,o=e.onChange,c=a(null);return n("input",{className:"editable-cell-input",ref:c,autoFocus:!0,type:"text",defaultValue:r,onBlur:t,onChange:o})},k=function(e){var t=e.onChange,o=e.setIsEditing,a=e.value,c=function(e){var n=e.target.value;null==t||t(n)},i=function(){o(!1)};return n(r,{children:"string"==typeof a?n(M,{defaultValue:a,onBlur:i,onChange:c}):"boolean"==typeof a?n(N,{value:a,onBlur:i,onChange:c}):null})},L=f({rows:[],tableRows:[]}),A=u((function(e,r){var t=e.borderClass,a=e.colIndex,c=e.content,s=e.header,l=e.isSelected,u=e.isTopLeftCell,d=e.onCellChange,f=e.onMouseDown,v=e.onMouseOver,g=e.row,m=e.rowIndex,w=h(L),b=w.rows,C=w.tableRows,y=o(c),x=y[0],D=y[1],R=o(!1),E=R[0],I=R[1],N=Boolean(null==s?void 0:s.isEditable),M=m%2==0,A="st-cell ".concat(l?u?"st-cell-selected-first-cell ".concat(t):"st-cell-selected ".concat(t):""," ").concat(M?"st-cell-odd-row":""," ").concat(N?"clickable":"");i((function(){D(c)}),[c]),i((function(){if(void 0!==g.originalRowIndex&&"number"==typeof g.originalRowIndex){var e=b[g.originalRowIndex];e[s.accessor]!==x?D(e[s.accessor]):C[g.originalRowIndex][s.accessor]=x}}),[s.accessor,x,b,g.originalRowIndex,C]);return n("div",E?p({className:"st-cell-editing ".concat(M?"st-cell-odd-row":"")},{children:n(k,{onChange:function(e){D(e),null==d||d({accessor:s.accessor,newValue:e,newRowIndex:m,originalRowIndex:g.originalRowIndex,row:g})},setIsEditing:I,value:x})}):p({className:A,onDoubleClick:function(){return s.isEditable&&I(!0)},onMouseDown:function(){return f(m,a)},onMouseOver:function(){return v(m,a)},ref:r},{children:x}))})),T=function(){return n("div",{className:"st-row-separator"})},S=function(t){var o=t.getBorderClass,a=t.handleMouseDown,c=t.handleMouseOver,i=t.headers,s=t.hiddenColumns,l=t.isSelected,u=t.isTopLeftCell,f=t.isWidthDragging,h=t.onCellChange,g=t.shouldDisplayLastColumnCell,m=t.shouldPaginate,w=t.sortedRows,b=t.tableRef;return n(r,{children:w.map((function(r,t){return e(v,{children:[e(C,p({allowHorizontalAnimate:m,pauseAnimation:f,tableRef:b},{children:[i.map((function(e,i){if(s[e.accessor])return null;var f=r[e.accessor];return e.cellRenderer&&(f=e.cellRenderer(r)),n(A,{borderClass:o(t,i),colIndex:i,content:f,header:e,isSelected:l(t,i),isTopLeftCell:u(t,i),onCellChange:h,onMouseDown:function(){return a(t,i)},onMouseOver:function(){return c(t,i)},ref:d(),row:r,rowIndex:t},e.accessor)})),n(E,{ref:d(),visible:g})]})),t!==w.length-1&&n(T,{})]},r.originalRowIndex)}))})},O=function(r){var t=r.currentPage,o=r.hideFooter,a=r.nextIcon,c=r.onPageChange,i=r.prevIcon,s=r.rowsPerPage,l=r.shouldPaginate,u=r.totalRows,d=Math.ceil(u/s),f=t>1,h=t<d,v=function(e){e>=1&&e<=d&&c(e)};return o||!l?null:e("div",p({className:"st-footer"},{children:[n("button",p({className:"st-next-prev-btn ".concat(f?"":"disabled"),onClick:function(){return v(t-1)},disabled:!f},{children:i})),n("button",p({className:"st-next-prev-btn ".concat(h?"":"disabled"),onClick:function(){return v(t+1)},disabled:!h},{children:a})),Array.from({length:d},(function(e,r){return n("button",p({onClick:function(){return v(r+1)},className:"st-page-btn ".concat(t===r+1?"active":"")},{children:r+1}),r)}))]}))},B=function(e){var r=e.className;return n("svg",p({className:r,viewBox:"0 0 24 24",width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}))},H=function(e){var r=e.className;return n("svg",p({className:r,viewBox:"0 0 24 24",width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})}))},P=function(e){var r=e.className;return n("svg",p({className:r,viewBox:"0 0 20 20",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M5.41 11.41L10 6.83l4.59 4.58L16 10l-6-6-6 6z"})}))},U=function(e){var r=e.className;return n("svg",p({className:r,viewBox:"0 0 20 20",width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M5.41 7.59L10 12.17l4.59-4.58L16 9l-6 6-6-6z"})}))},z=function(r){var t=r.checked,a=void 0!==t&&t,c=r.children,i=r.onChange,s=o(a),l=s[0],u=s[1];return e("label",p({className:"st-checkbox-label"},{children:[n("input",{checked:l,className:"st-checkbox-input",onChange:function(){var e=!l;u(e),i&&i(e)},type:"checkbox"}),n("span",p({className:"st-checkbox-custom ".concat(l?"st-checked":"")},{children:l&&n("span",{className:"st-checkbox-checkmark"})})),c]}))},j=function(e){var r=e.headers,t=e.open,o=e.position;e.setOpen;var a=e.setHiddenColumns,c=e.hiddenColumns,i="left"===o?"left":"";return n("div",p({className:"st-column-editor-popout ".concat(t?"open":""," ").concat(i),onClick:function(e){return e.stopPropagation()}},{children:n("div",p({className:"st-column-editor-popout-content"},{children:r.map((function(e,r){return n(z,p({checked:c[e.accessor],onChange:function(n){var r;return a(p(p({},c),((r={})[e.accessor]=n,r)))}},{children:e.label}),r)}))}))}))},W=function(r){var t=r.columnEditorText,a=r.editColumns,c=r.headers,i=r.position,s=void 0===i?"right":i,l=r.setHiddenColumns,u=r.hiddenColumns,d=o(!1),f=d[0],h=d[1];return a?e("div",p({className:"st-column-editor ".concat(f?"open":""," ").concat(s),onClick:function(){return function(e){h(e)}(!f)}},{children:[n("div",p({className:"st-column-editor-text"},{children:t})),n(j,{headers:c,open:f,position:s,setOpen:h,setHiddenColumns:l,hiddenColumns:u})]})):null},F=function(r){var t=r.columnEditorPosition,s=void 0===t?"right":t,l=r.columnEditorText,u=void 0===l?"Columns":l,d=r.columnResizing,f=void 0!==d&&d,h=r.defaultHeaders,v=r.draggable,b=void 0!==v&&v,C=r.editColumns,y=void 0!==C&&C,x=r.height,D=r.hideFooter,R=void 0!==D&&D,E=r.importStyles,N=void 0===E||E,M=r.nextIcon,k=void 0===M?n(H,{className:"st-next-prev-icon"}):M,A=r.onCellChange,T=r.prevIcon,z=void 0===T?n(B,{className:"st-next-prev-icon"}):T,j=r.rows,F=r.rowsPerPage,X=void 0===F?10:F,V=r.selectableCells,q=void 0!==V&&V,Y=r.shouldPaginate,Q=void 0!==Y&&Y,J=r.sortDownIcon,K=void 0===J?n(U,{className:"st-sort-icon"}):J,G=r.sortUpIcon,_=void 0===G?n(P,{className:"st-sort-icon"}):G,Z=g((function(){return j.map((function(e,n){return p(p({},e),{originalRowIndex:n})}))}),[j]),$=a(null),ee=o(!1),ne=ee[0],re=ee[1],te=a(h),oe=o(null),ae=oe[0],ce=oe[1],ie=o({}),se=ie[0],le=ie[1],ue=o(1),de=ue[0],fe=ue[1],he=g((function(){if(!ae)return Z;var e=function(e,n,r){var t=r?r.key:e[0],o="ascending";return r&&r.key.accessor===t.accessor&&"ascending"===r.direction&&(o="descending"),{sortedData:w([],n,!0).sort((function(e,n){return e[t.accessor]<n[t.accessor]?"ascending"===o?1:-1:e[t.accessor]>n[t.accessor]?"ascending"===o?-1:1:0})),newSortConfig:{key:t,direction:o}}}(te.current,Z,ae).sortedData;return e}),[Z,ae]),ve=m((function(e){return e+1}),0)[1],ge=function(e){var n=e.selectableCells,r=e.headers,t=e.rows,s=o([]),l=s[0],u=s[1],d=a(!1),f=a(null),h=c((function(){var e=l.reduce((function(e,n){var o=n.row,a=n.col;return e[o]||(e[o]=[]),e[o][a]=t[o][r[a].accessor],e}),{}),n=Object.values(e).map((function(e){return Object.values(e).join("\t")})).join("\n");navigator.clipboard.writeText(n)}),[l,t,r]);i((function(){var e=function(e){(e.ctrlKey||e.metaKey)&&"c"===e.key&&h()};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[h,l]);var v=function(e,n){return l.some((function(r){return r.row===e&&r.col===n}))};return{selectedCells:l,handleMouseDown:function(e,r){n&&(d.current=!0,f.current={row:e,col:r},u([{row:e,col:r}]))},handleMouseOver:function(e,r){if(n&&d.current&&f.current){for(var t=[],o=Math.min(f.current.row,e),a=Math.max(f.current.row,e),c=Math.min(f.current.col,r),i=Math.max(f.current.col,r),s=o;s<=a;s++)for(var l=c;l<=i;l++)t.push({row:s,col:l});u(t)}},handleMouseUp:function(){d.current=!1,f.current=null},isSelected:v,getBorderClass:function(e,n){var r=[];return v(e-1,n)||r.push("st-selected-top-border"),v(e+1,n)||r.push("st-selected-bottom-border"),v(e,n-1)||r.push("st-selected-left-border"),v(e,n+1)||r.push("st-selected-right-border"),r.join(" ")},isTopLeftCell:function(e,n){return e===Math.min.apply(Math,l.map((function(e){return e.row})))&&n===Math.min.apply(Math,l.map((function(e){return e.col})))},setSelectedCells:u}}({selectableCells:q,headers:te.current,rows:he}),me=ge.handleMouseDown,pe=ge.handleMouseOver,we=ge.handleMouseUp,be=ge.isSelected,Ce=ge.getBorderClass,ye=ge.isTopLeftCell,xe=ge.setSelectedCells,De=te.current.filter((function(e){return!e.hide})),Re=g((function(){return!!$.current&&De.reduce((function(e,n){return e+n.width}),0)<$.current.clientWidth}),[De]),Ee=Q?he.slice((de-1)*X,de*X):he;i((function(){var e=function(e){e.target.closest(".st-cell")||xe([])};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[xe]);var Ie=g((function(){return"".concat(De.filter((function(e){return!0!==se[e.accessor]})).map((function(e){return"".concat(e.width,"px")})).join(" ")," 1fr")}),[De,se]);return i((function(){var e="development"===process.env.NODE_ENV;N&&e?require("../../styles/simple-table.css"):require("./styles/simple-table.css")}),[N]),n(L.Provider,p({value:{rows:j,tableRows:Z}},{children:e("div",p({className:"st-wrapper",style:x?{height:x}:{}},{children:[e("div",p({className:"st-table-wrapper"},{children:[e("div",p({className:"st-table",onMouseUp:we,onMouseLeave:we,ref:$,style:{gridTemplateColumns:Ie}},{children:[n(I,{columnResizing:f,draggable:b,forceUpdate:ve,headersRef:te,hiddenColumns:se,isWidthDragging:ne,onSort:function(e,n){ce((function(r){return(null==r?void 0:r.key.accessor)!==n?{key:te.current[e],direction:"ascending"}:"ascending"===(null==r?void 0:r.direction)?{key:te.current[e],direction:"descending"}:null}))},onTableHeaderDragEnd:function(e){te.current=e,ve()},setIsWidthDragging:re,shouldDisplayLastColumnCell:Re,sort:ae,sortDownIcon:K,sortUpIcon:_,tableRef:$}),n(S,{getBorderClass:Ce,handleMouseDown:me,handleMouseOver:pe,headers:te.current,hiddenColumns:se,isSelected:be,isTopLeftCell:ye,isWidthDragging:ne,onCellChange:A,shouldDisplayLastColumnCell:Re,shouldPaginate:Q,sortedRows:Ee,tableRef:$})]})),n(W,{headers:te.current,columnEditorText:u,editColumns:y,position:s,setHiddenColumns:le,hiddenColumns:se})]})),n(O,{currentPage:de,hideFooter:R,nextIcon:k,onPageChange:fe,prevIcon:z,rowsPerPage:X,shouldPaginate:Q,totalRows:he.length})]}))}))};export{F as SimpleTable};

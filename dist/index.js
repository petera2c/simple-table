import{jsxs as e,jsx as n,Fragment as r}from"react/jsx-runtime";import t,{useState as o,useRef as a,useCallback as c,useEffect as i,Children as s,useLayoutEffect as u,forwardRef as l,createRef as d,Fragment as f,useReducer as h,useMemo as v}from"react";var g=function(){return g=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},g.apply(this,arguments)};function p(e,n,r){if(r||2===arguments.length)for(var t,o=0,a=n.length;o<a;o++)!t&&o in n||(t||(t=Array.prototype.slice.call(n,0,o)),t[o]=n[o]);return e.concat(t||Array.prototype.slice.call(n))}"function"==typeof SuppressedError&&SuppressedError;var m=function(e){var n={};return s.forEach(e,(function(e,r){if(e.ref&&e.ref.current){var t=e.ref.current.getBoundingClientRect();n[e.key]=t}})),n},w=function(e){var n,r,c=e.allowHorizontalAnimate,s=void 0===c||c,l=e.children,d=e.pauseAnimation,f=o({}),h=f[0],v=f[1],g=o({}),p=g[0],w=g[1],b=(n=l,r=a(),i((function(){r.current=n}),[n]),r.current);return u((function(){var e=m(l);v(e)}),[l]),u((function(){var e=m(b);w(e)}),[b]),i((function(){d||Object.keys(p).length&&t.Children.forEach(l,(function(e){var n=e.ref.current,r=p[e.key],t=h[e.key],o=r.left-t.left,a=s?0:r.top-t.top,c=Math.abs(o),i=Math.abs(a);(c>10||i>10)&&requestAnimationFrame((function(){n.style.transform="translate(".concat(o,"px, ").concat(a,"px)"),n.style.transition="transform 0s",requestAnimationFrame((function(){n.style.transform="",n.style.transition="transform 500ms"}))}))}))}),[s,h,l,d,p]),l},b=!1,C=function(e){var n=e.draggedHeaderRef,r=e.headersRef,t=e.hoveredHeaderRef,o=e.onTableHeaderDragEnd;return{handleDragStart:function(e){n.current=e},handleDragOver:function(e){!function(e){var a;if(!b&&(t.current=e,e.accessor!==(null===(a=n.current)||void 0===a?void 0:a.accessor)&&null!==n.current&&!b)){if(b=!0,!r.current)return;var c=p([],r.current,!0),i=c.findIndex((function(e){var r;return e.accessor===(null===(r=n.current)||void 0===r?void 0:r.accessor)})),s=c.findIndex((function(n){return n.accessor===e.accessor}));if(void 0===i||void 0===s)return;var u=c.splice(i,1)[0];c.splice(s,0,u),JSON.stringify(c)!==JSON.stringify(r.current)&&setTimeout((function(){o(c),setTimeout((function(){b=!1}),500)}),50)}}(e)},handleDragEnd:function(){n.current=null,t.current=null}}},D=function(e,n){var r=!0,t=!0;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(r)return r=!1,void setTimeout((function(){return t=!1}),n);t||(e.apply(this,o),t=!0,setTimeout((function(){return t=!1}),n))}},y=l((function(r,t){var c,i=r.draggedHeaderRef,s=r.enableColumnResizing,u=r.forceUpdate,l=r.headersRef,d=r.hoveredHeaderRef,f=r.index,h=r.onSort,v=r.onTableHeaderDragEnd,p=r.setIsWidthDragging,m=a({pageX:0,pageY:0}),w=o(!1),b=w[0],y=w[1],M=null===(c=l.current)||void 0===c?void 0:c[f],x=C({draggedHeaderRef:i,headersRef:l,hoveredHeaderRef:d,onTableHeaderDragEnd:v}),R=x.handleDragStart,L=x.handleDragOver,E=x.handleDragEnd,S=a(D((function(e){L(e)}),100)).current;return M?e("div",g({className:"st-header-cell ".concat(M===d.current?"st-hovered":""," ").concat(b?"st-dragging":""),ref:t,style:{width:M.width}},{children:[n("div",g({className:"st-header-label",draggable:!0,onClick:function(){return h(f)},onDragStart:function(){return function(e){y(!0),R(e)}(M)},onDragOver:function(e){var n=e.pageX,r=e.pageY;n===m.current.pageX&&r===m.current.pageY||(m.current={pageX:n,pageY:r},e.preventDefault(),S(M,e))},onDragEnd:function(){y(!1),E()}},{children:null==M?void 0:M.label})),s&&n("div",{className:"st-header-resize-handle",onMouseDown:function(e){p(!0),e.preventDefault();var n=e.clientX;if(M){var r=M.width,t=D((function(e){var t=Math.max(r+(e.clientX-n),10);M&&(l.current[f].width=t,u())}),10),o=function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",o),p(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",o)}}})]})):null})),M=l((function(e,r){return e.visible?n("div",{className:"st-cell",ref:r}):n("div",{ref:r})})),x=function(){return n("div",{className:"st-row-separator"})},R=function(t){var o,c=t.enableColumnResizing,i=t.forceUpdate,s=t.headersRef,u=t.isWidthDragging,l=t.onSort,f=t.onTableHeaderDragEnd,h=t.setIsWidthDragging,v=t.shouldDisplayLastColumnCell,p=a(null),m=a(null);return e(r,{children:[e(w,g({pauseAnimation:u},{children:[null===(o=s.current)||void 0===o?void 0:o.map((function(e,r){return n(y,{draggedHeaderRef:p,enableColumnResizing:c,forceUpdate:i,headersRef:s,hoveredHeaderRef:m,index:r,onSort:l,onTableHeaderDragEnd:f,ref:d(),setIsWidthDragging:h},e.accessor)})),n(M,{ref:d(),visible:v})]})),n(x,{})]})},L=l((function(e,r){var t=e.rowIndex,o=e.colIndex,a=e.content,c=e.isSelected,i=e.isTopLeftCell,s=e.borderClass,u=e.onMouseDown,l=e.onMouseOver,d=t%2==0;return n("div",g({onMouseDown:function(){return u(t,o)},onMouseOver:function(){return l(t,o)},ref:r,className:"st-cell ".concat(c?i?"st-cell-selected-first-cell ".concat(s):"st-cell-selected ".concat(s):""," ").concat(d?"st-cell-odd-row":"")},{children:a}))})),E=function(t){var o=t.getBorderClass,a=t.handleMouseDown,c=t.handleMouseOver,i=t.headers,s=t.isSelected,u=t.isTopLeftCell,l=t.isWidthDragging,h=t.shouldDisplayLastColumnCell,v=t.shouldPaginate,p=t.sortedRows;return n(r,{children:p.map((function(r,t){return e(f,{children:[e(w,g({allowHorizontalAnimate:v,pauseAnimation:l},{children:[i.map((function(e,i){var l=r[e.accessor];return e.cellRenderer&&(l=e.cellRenderer(r)),n(L,{borderClass:o(t,i),colIndex:i,content:l,isSelected:s(t,i),isTopLeftCell:u(t,i),onMouseDown:function(){return a(t,i)},onMouseOver:function(){return c(t,i)},ref:d(),rowIndex:t},e.accessor)})),n(M,{ref:d(),visible:h})]})),t!==p.length-1&&n(x,{})]},r.id)}))})},S=function(r){var t=r.currentPage,o=r.hideFooter,a=r.nextIcon,c=r.onPageChange,i=r.prevIcon,s=r.rowsPerPage,u=r.totalRows,l=Math.ceil(u/s),d=function(e){e>=1&&e<=l&&c(e)};return o?null:e("div",g({className:"st-footer"},{children:[n("button",g({className:"st-next-prev-btn",onClick:function(){return d(t-1)},disabled:1===t},{children:i})),n("button",g({className:"st-next-prev-btn",onClick:function(){return d(t+1)},disabled:t===l},{children:a})),Array.from({length:l},(function(e,r){return n("button",g({onClick:function(){return d(r+1)},className:"st-page-btn ".concat(t===r+1?"active":"")},{children:r+1}),r)}))]}))},O=function(){return n("svg",g({className:"angle-icon",viewBox:"0 0 24 24",width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}))},T=function(){return n("svg",g({className:"angle-icon",viewBox:"0 0 24 24",width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"},{children:n("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})}))},H=function(r){var t,s=r.defaultHeaders,u=r.enableColumnResizing,l=void 0===u||u,d=r.height,f=r.hideFooter,m=void 0!==f&&f,w=r.nextIcon,b=void 0===w?n(T,{}):w,C=r.prevIcon,D=void 0===C?n(O,{}):C,y=r.rows,M=r.rowsPerPage,x=void 0===M?10:M,L=r.shouldPaginate,H=void 0===L||L,I=o(!1),N=I[0],P=I[1],k=a(s),j=o(y),z=j[0],A=j[1],W=o(null),B=W[0],U=W[1],F=h((function(e){return e+1}),0)[1],X=o(1),Y=X[0],q=X[1],J=a(null),K=v((function(){return!!J.current&&k.current.reduce((function(e,n){return e+n.width}),0)<J.current.clientWidth}),[]),G=function(e,n){var r=o([]),t=r[0],s=r[1],u=a(!1),l=a(null),d=c((function(){var r=t.reduce((function(r,t){var o=t.row,a=t.col;return r[o]||(r[o]=[]),r[o][a]=e[o][n[a].accessor],r}),{}),o=Object.values(r).map((function(e){return Object.values(e).join("\t")})).join("\n");navigator.clipboard.writeText(o)}),[t,e,n]);i((function(){var e=function(e){(e.ctrlKey||e.metaKey)&&"c"===e.key&&d()};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[d,t]);var f=function(e,n){return t.some((function(r){return r.row===e&&r.col===n}))};return{selectedCells:t,handleMouseDown:function(e,n){u.current=!0,l.current={row:e,col:n},s([{row:e,col:n}])},handleMouseOver:function(e,n){if(u.current&&l.current){for(var r=[],t=Math.min(l.current.row,e),o=Math.max(l.current.row,e),a=Math.min(l.current.col,n),c=Math.max(l.current.col,n),i=t;i<=o;i++)for(var d=a;d<=c;d++)r.push({row:i,col:d});s(r)}},handleMouseUp:function(){u.current=!1,l.current=null},isSelected:f,getBorderClass:function(e,n){var r=[];return f(e-1,n)||r.push("st-selected-top-border"),f(e+1,n)||r.push("st-selected-bottom-border"),f(e,n-1)||r.push("st-selected-left-border"),f(e,n+1)||r.push("st-selected-right-border"),r.join(" ")},isTopLeftCell:function(e,n){return e===Math.min.apply(Math,t.map((function(e){return e.row})))&&n===Math.min.apply(Math,t.map((function(e){return e.col})))},setSelectedCells:s}}(z,k.current),Q=G.handleMouseDown,V=G.handleMouseOver,Z=G.handleMouseUp,$=G.isSelected,_=G.getBorderClass,ee=G.isTopLeftCell,ne=G.setSelectedCells;i((function(){var e=function(e){e.target.closest(".st-cell")||ne([])};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[ne]);var re=H?z.slice((Y-1)*x,Y*x):z;return e("div",g({ref:J,className:"st-wrapper",style:d?{height:d}:{}},{children:[e("div",g({className:"st-table",onMouseUp:Z,onMouseLeave:Z,style:{gridTemplateColumns:"".concat(null===(t=k.current)||void 0===t?void 0:t.map((function(e){return"".concat(e.width,"px")})).join(" ")," 1fr")}},{children:[n(R,{enableColumnResizing:l,forceUpdate:F,headersRef:k,isWidthDragging:N,onSort:function(e){var n=function(e,n,r,t){var o=e[t],a="ascending";return r&&r.key.accessor===o.accessor&&"ascending"===r.direction&&(a="descending"),{sortedData:p([],n,!0).sort((function(e,n){return e[o.accessor]<n[o.accessor]?"ascending"===a?-1:1:e[o.accessor]>n[o.accessor]?"ascending"===a?1:-1:0})),newSortConfig:{key:o,direction:a}}}(k.current,z,B,e),r=n.sortedData,t=n.newSortConfig;A(r),U(t)},onTableHeaderDragEnd:function(e){k.current=e,F()},setIsWidthDragging:P,shouldDisplayLastColumnCell:K}),n(E,{getBorderClass:_,handleMouseDown:Q,handleMouseOver:V,headers:k.current,isSelected:$,isTopLeftCell:ee,isWidthDragging:N,shouldDisplayLastColumnCell:K,shouldPaginate:H,sortedRows:re})]})),H&&n(S,{currentPage:Y,hideFooter:m,onPageChange:q,rowsPerPage:x,totalRows:z.length,nextIcon:b,prevIcon:D})]}))};export{H as SimpleTable};
